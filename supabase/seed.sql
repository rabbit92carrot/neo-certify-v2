-- =============================================================================
-- Neo-Certify v2 Seed Data
-- 현실적인 한국 의료기기 인증 시나리오 데이터
-- =============================================================================

-- ============================================================
-- 1. Auth Users (Supabase auth.users)
-- ============================================================
-- NOTE: Supabase local dev에서는 auth.users에 직접 삽입 가능
-- 프로덕션에서는 supabase.auth.admin.createUser() 사용

INSERT INTO auth.users (id, instance_id, email, encrypted_password, email_confirmed_at, role, aud, created_at, updated_at, raw_app_meta_data, raw_user_meta_data)
VALUES
  -- 관리자
  ('a0000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'admin@neocert.com',     crypt('admin123', gen_salt('bf')), now(), 'authenticated', 'authenticated', now(), now(), '{"provider":"email","providers":["email"]}', '{}'),
  -- 제조사
  ('a0000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000000', 'meditech@neocert.com',  crypt('test1234', gen_salt('bf')), now(), 'authenticated', 'authenticated', now(), now(), '{"provider":"email","providers":["email"]}', '{}'),
  -- 유통사
  ('a0000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000000', 'supply@neocert.com',    crypt('test1234', gen_salt('bf')), now(), 'authenticated', 'authenticated', now(), now(), '{"provider":"email","providers":["email"]}', '{}'),
  -- 병원1
  ('a0000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000000', 'seoul-ps@neocert.com',  crypt('test1234', gen_salt('bf')), now(), 'authenticated', 'authenticated', now(), now(), '{"provider":"email","providers":["email"]}', '{}'),
  -- 병원2
  ('a0000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000000', 'gangnam@neocert.com',   crypt('test1234', gen_salt('bf')), now(), 'authenticated', 'authenticated', now(), now(), '{"provider":"email","providers":["email"]}', '{}')
ON CONFLICT (id) DO NOTHING;

-- auth.identities (Supabase 필수)
INSERT INTO auth.identities (id, user_id, provider_id, provider, identity_data, last_sign_in_at, created_at, updated_at)
VALUES
  ('a0000000-0000-0000-0000-000000000001', 'a0000000-0000-0000-0000-000000000001', 'a0000000-0000-0000-0000-000000000001', 'email', '{"sub":"a0000000-0000-0000-0000-000000000001","email":"admin@neocert.com"}', now(), now(), now()),
  ('a0000000-0000-0000-0000-000000000002', 'a0000000-0000-0000-0000-000000000002', 'a0000000-0000-0000-0000-000000000002', 'email', '{"sub":"a0000000-0000-0000-0000-000000000002","email":"meditech@neocert.com"}', now(), now(), now()),
  ('a0000000-0000-0000-0000-000000000003', 'a0000000-0000-0000-0000-000000000003', 'a0000000-0000-0000-0000-000000000003', 'email', '{"sub":"a0000000-0000-0000-0000-000000000003","email":"supply@neocert.com"}', now(), now(), now()),
  ('a0000000-0000-0000-0000-000000000004', 'a0000000-0000-0000-0000-000000000004', 'a0000000-0000-0000-0000-000000000004', 'email', '{"sub":"a0000000-0000-0000-0000-000000000004","email":"seoul-ps@neocert.com"}', now(), now(), now()),
  ('a0000000-0000-0000-0000-000000000005', 'a0000000-0000-0000-0000-000000000005', 'a0000000-0000-0000-0000-000000000005', 'email', '{"sub":"a0000000-0000-0000-0000-000000000005","email":"gangnam@neocert.com"}', now(), now(), now())
ON CONFLICT (id) DO NOTHING;

-- ============================================================
-- 2. Organizations
-- ============================================================

INSERT INTO organizations (id, type, name, email, business_number, representative_name, representative_phone, address, status, auth_user_id) VALUES
  -- 관리자
  ('b0000000-0000-0000-0000-000000000001', 'ADMIN',        '네오서트 관리자',        'admin@neocert.com',    '1234567890', '김관리', '010-0000-0001', '서울시 강남구 테헤란로 123', 'ACTIVE', 'a0000000-0000-0000-0000-000000000001'),
  -- 제조사
  ('b0000000-0000-0000-0000-000000000002', 'MANUFACTURER', '(주)메디텍코리아',       'meditech@neocert.com', '2345678901', '이제조', '010-0000-0002', '경기도 성남시 분당구 판교로 456', 'ACTIVE', 'a0000000-0000-0000-0000-000000000002'),
  -- 유통사
  ('b0000000-0000-0000-0000-000000000003', 'DISTRIBUTOR',  '한국메디컬서플라이',     'supply@neocert.com',   '3456789012', '박유통', '010-0000-0003', '서울시 서초구 서초대로 789', 'ACTIVE', 'a0000000-0000-0000-0000-000000000003'),
  -- 병원1
  ('b0000000-0000-0000-0000-000000000004', 'HOSPITAL',     '서울중앙성형외과',       'seoul-ps@neocert.com', '4567890123', '정병원', '010-0000-0004', '서울시 강남구 신사동 123-45', 'ACTIVE', 'a0000000-0000-0000-0000-000000000004'),
  -- 병원2
  ('b0000000-0000-0000-0000-000000000005', 'HOSPITAL',     '강남뷰티클리닉',         'gangnam@neocert.com',  '5678901234', '최의사', '010-0000-0005', '서울시 강남구 압구정로 456-78', 'ACTIVE', 'a0000000-0000-0000-0000-000000000005')
ON CONFLICT (id) DO NOTHING;

-- ============================================================
-- 3. Manufacturer Settings
-- ============================================================

INSERT INTO manufacturer_settings (id, organization_id, hmac_secret, code_prefix) VALUES
  ('c0000000-0000-0000-0000-000000000001', 'b0000000-0000-0000-0000-000000000002', 'meditech-hmac-secret-key-2024', 'MT')
ON CONFLICT (id) DO NOTHING;

-- ============================================================
-- 4. Products (제조사: 메디텍코리아)
-- ============================================================

INSERT INTO products (id, organization_id, name, udi_di, model_name) VALUES
  -- 코 임플란트
  ('d0000000-0000-0000-0000-000000000001', 'b0000000-0000-0000-0000-000000000002', '코 임플란트 (실리콘, L형) S', 'MT-NOSE-SIL-L-S', 'MT-NI-S100'),
  ('d0000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000002', '코 임플란트 (실리콘, L형) M', 'MT-NOSE-SIL-L-M', 'MT-NI-M100'),
  ('d0000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000002', '코 임플란트 (실리콘, L형) L', 'MT-NOSE-SIL-L-L', 'MT-NI-L100'),
  -- 턱 임플란트
  ('d0000000-0000-0000-0000-000000000004', 'b0000000-0000-0000-0000-000000000002', '턱 임플란트 (고어텍스)',       'MT-CHIN-GOR',     'MT-CI-G100'),
  -- 필러
  ('d0000000-0000-0000-0000-000000000005', 'b0000000-0000-0000-0000-000000000002', '필러 (히알루론산) 0.5ml',     'MT-FIL-HA-05',    'MT-FH-050'),
  ('d0000000-0000-0000-0000-000000000006', 'b0000000-0000-0000-0000-000000000002', '필러 (히알루론산) 1.0ml',     'MT-FIL-HA-10',    'MT-FH-100'),
  ('d0000000-0000-0000-0000-000000000007', 'b0000000-0000-0000-0000-000000000002', '필러 (히알루론산) 2.0ml',     'MT-FIL-HA-20',    'MT-FH-200')
ON CONFLICT (id) DO NOTHING;

-- ============================================================
-- 5. Lots
-- ============================================================

INSERT INTO lots (id, product_id, lot_number, quantity, manufacture_date, expiry_date) VALUES
  -- 코 임플란트 S: 2 lots
  ('e0000000-0000-0000-0000-000000000001', 'd0000000-0000-0000-0000-000000000001', 'LOT-NIS-2024-001', 15, '2024-01-15', '2027-01-15'),
  ('e0000000-0000-0000-0000-000000000002', 'd0000000-0000-0000-0000-000000000001', 'LOT-NIS-2024-002', 10, '2024-06-01', '2027-06-01'),
  -- 코 임플란트 M: 2 lots
  ('e0000000-0000-0000-0000-000000000003', 'd0000000-0000-0000-0000-000000000002', 'LOT-NIM-2024-001', 20, '2024-02-10', '2027-02-10'),
  ('e0000000-0000-0000-0000-000000000004', 'd0000000-0000-0000-0000-000000000002', 'LOT-NIM-2024-002', 15, '2024-07-01', '2027-07-01'),
  -- 코 임플란트 L: 2 lots
  ('e0000000-0000-0000-0000-000000000005', 'd0000000-0000-0000-0000-000000000003', 'LOT-NIL-2024-001', 10, '2024-03-05', '2027-03-05'),
  ('e0000000-0000-0000-0000-000000000006', 'd0000000-0000-0000-0000-000000000003', 'LOT-NIL-2024-002', 10, '2024-08-15', '2027-08-15'),
  -- 턱 임플란트: 3 lots
  ('e0000000-0000-0000-0000-000000000007', 'd0000000-0000-0000-0000-000000000004', 'LOT-CIG-2024-001', 12, '2024-01-20', '2027-01-20'),
  ('e0000000-0000-0000-0000-000000000008', 'd0000000-0000-0000-0000-000000000004', 'LOT-CIG-2024-002', 10, '2024-05-10', '2027-05-10'),
  ('e0000000-0000-0000-0000-000000000009', 'd0000000-0000-0000-0000-000000000004', 'LOT-CIG-2024-003', 8,  '2024-09-01', '2027-09-01'),
  -- 필러 0.5ml: 2 lots
  ('e0000000-0000-0000-0000-000000000010', 'd0000000-0000-0000-0000-000000000005', 'LOT-FH05-2024-001', 20, '2024-04-01', '2026-04-01'),
  ('e0000000-0000-0000-0000-000000000011', 'd0000000-0000-0000-0000-000000000005', 'LOT-FH05-2024-002', 15, '2024-08-01', '2026-08-01'),
  -- 필러 1.0ml: 2 lots
  ('e0000000-0000-0000-0000-000000000012', 'd0000000-0000-0000-0000-000000000006', 'LOT-FH10-2024-001', 20, '2024-03-15', '2026-03-15'),
  ('e0000000-0000-0000-0000-000000000013', 'd0000000-0000-0000-0000-000000000006', 'LOT-FH10-2024-002', 15, '2024-09-01', '2026-09-01'),
  -- 필러 2.0ml: 2 lots
  ('e0000000-0000-0000-0000-000000000014', 'd0000000-0000-0000-0000-000000000007', 'LOT-FH20-2024-001', 10, '2024-05-01', '2026-05-01'),
  ('e0000000-0000-0000-0000-000000000015', 'd0000000-0000-0000-0000-000000000007', 'LOT-FH20-2024-002', 10, '2024-10-01', '2026-10-01')
ON CONFLICT (id) DO NOTHING;

-- ============================================================
-- 6. Virtual Codes
-- 다양한 상태: 제조사 재고, 유통사 재고, 병원 재고, 시술됨, 폐기됨
-- ============================================================

-- ===== 코 임플란트 S - LOT 001 (15개) =====
-- 5개: 제조사 재고
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id) VALUES
  ('f0000000-0000-0000-0001-000000000001', 'MT-NIS1-0001',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000002'),
  ('f0000000-0000-0000-0001-000000000002', 'MT-NIS1-0002',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000002'),
  ('f0000000-0000-0000-0001-000000000003', 'MT-NIS1-0003',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000002'),
  ('f0000000-0000-0000-0001-000000000004', 'MT-NIS1-0004',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000002'),
  ('f0000000-0000-0000-0001-000000000005', 'MT-NIS1-0005',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000002');
-- 5개: 유통사 재고
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id) VALUES
  ('f0000000-0000-0000-0001-000000000006', 'MT-NIS1-0006',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000003'),
  ('f0000000-0000-0000-0001-000000000007', 'MT-NIS1-0007',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000003'),
  ('f0000000-0000-0000-0001-000000000008', 'MT-NIS1-0008',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000003'),
  ('f0000000-0000-0000-0001-000000000009', 'MT-NIS1-0009',  'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000003'),
  ('f0000000-0000-0000-0001-000000000010', 'MT-NIS1-0010', 'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000003');
-- 3개: 병원1 재고
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id) VALUES
  ('f0000000-0000-0000-0001-000000000011', 'MT-NIS1-0011', 'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000004'),
  ('f0000000-0000-0000-0001-000000000012', 'MT-NIS1-0012', 'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000004'),
  ('f0000000-0000-0000-0001-000000000013', 'MT-NIS1-0013', 'e0000000-0000-0000-0000-000000000001', 'IN_STOCK', 'b0000000-0000-0000-0000-000000000004');

-- ===== 코 임플란트 S - LOT 002 (10개) =====
-- 모두 제조사 재고
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT
  ('f0000000-0000-0000-0002-' || lpad(i::text, 12, '0'))::uuid,
  ('MT-NIS2' || '-' || lpad(i::text, 4, '0')),
  'e0000000-0000-0000-0000-000000000002',
  'IN_STOCK',
  'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 10) AS i;

-- ===== 코 임플란트 M - LOT 001 (20개) =====
-- 8 제조사, 6 유통사, 4 병원1, 2 병원2
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0003-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-NIM1' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000003', 'IN_STOCK',
       CASE
         WHEN i <= 8 THEN 'b0000000-0000-0000-0000-000000000002'::uuid  -- 제조사
         WHEN i <= 14 THEN 'b0000000-0000-0000-0000-000000000003'::uuid -- 유통사
         WHEN i <= 18 THEN 'b0000000-0000-0000-0000-000000000004'::uuid -- 병원1
         ELSE 'b0000000-0000-0000-0000-000000000005'::uuid              -- 병원2
       END
FROM generate_series(1, 20) AS i;

-- ===== 코 임플란트 M - LOT 002 (15개) — 전부 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0004-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-NIM2' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000004', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 15) AS i;

-- ===== 코 임플란트 L - LOT 001 (10개) =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0005-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-NIL1' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000005', 'IN_STOCK',
       CASE WHEN i <= 5 THEN 'b0000000-0000-0000-0000-000000000002'::uuid
            ELSE 'b0000000-0000-0000-0000-000000000003'::uuid END
FROM generate_series(1, 10) AS i;

-- ===== 코 임플란트 L - LOT 002 (10개) — 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0006-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-NIL2' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000006', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 10) AS i;

-- ===== 턱 임플란트 - LOT 001 (12개) =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0007-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-CIG1' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000007', 'IN_STOCK',
       CASE WHEN i <= 4 THEN 'b0000000-0000-0000-0000-000000000002'::uuid
            WHEN i <= 8 THEN 'b0000000-0000-0000-0000-000000000003'::uuid
            WHEN i <= 10 THEN 'b0000000-0000-0000-0000-000000000004'::uuid
            ELSE 'b0000000-0000-0000-0000-000000000005'::uuid END
FROM generate_series(1, 12) AS i;

-- ===== 턱 임플란트 - LOT 002 (10개) — 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0008-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-CIG2' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000008', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 10) AS i;

-- ===== 턱 임플란트 - LOT 003 (8개) — 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0009-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-CIG3' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000009', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 8) AS i;

-- ===== 필러 0.5ml - LOT 001 (20개) =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0010-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-FH05A' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000010', 'IN_STOCK',
       CASE WHEN i <= 8 THEN 'b0000000-0000-0000-0000-000000000002'::uuid
            WHEN i <= 14 THEN 'b0000000-0000-0000-0000-000000000003'::uuid
            WHEN i <= 18 THEN 'b0000000-0000-0000-0000-000000000004'::uuid
            ELSE 'b0000000-0000-0000-0000-000000000005'::uuid END
FROM generate_series(1, 20) AS i;

-- ===== 필러 0.5ml - LOT 002 (15개) — 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0011-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-FH05B' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000011', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 15) AS i;

-- ===== 필러 1.0ml - LOT 001 (20개) =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0012-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-FH10A' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000012', 'IN_STOCK',
       CASE WHEN i <= 10 THEN 'b0000000-0000-0000-0000-000000000002'::uuid
            WHEN i <= 16 THEN 'b0000000-0000-0000-0000-000000000003'::uuid
            ELSE 'b0000000-0000-0000-0000-000000000004'::uuid END
FROM generate_series(1, 20) AS i;

-- ===== 필러 1.0ml - LOT 002 (15개) — 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0013-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-FH10B' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000013', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 15) AS i;

-- ===== 필러 2.0ml - LOT 001 (10개) =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0014-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-FH20A' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000014', 'IN_STOCK',
       CASE WHEN i <= 5 THEN 'b0000000-0000-0000-0000-000000000002'::uuid
            WHEN i <= 8 THEN 'b0000000-0000-0000-0000-000000000003'::uuid
            ELSE 'b0000000-0000-0000-0000-000000000004'::uuid END
FROM generate_series(1, 10) AS i;

-- ===== 필러 2.0ml - LOT 002 (10개) — 제조사 =====
INSERT INTO virtual_codes (id, code, lot_id, status, owner_org_id)
SELECT ('f0000000-0000-0000-0015-' || lpad(i::text, 12, '0'))::uuid,
       ('MT-FH20B' || '-' || lpad(i::text, 4, '0')), 'e0000000-0000-0000-0000-000000000015', 'IN_STOCK',
       'b0000000-0000-0000-0000-000000000002'
FROM generate_series(1, 10) AS i;

-- ============================================================
-- 7. Patients
-- ============================================================

INSERT INTO patients (id, phone_number) VALUES
  ('10000000-0000-0000-0000-000000000001', '010-1111-0001'),
  ('10000000-0000-0000-0000-000000000002', '010-1111-0002'),
  ('10000000-0000-0000-0000-000000000003', '010-1111-0003'),
  ('10000000-0000-0000-0000-000000000004', '010-1111-0004'),
  ('10000000-0000-0000-0000-000000000005', '010-1111-0005')
ON CONFLICT (id) DO NOTHING;

-- ============================================================
-- 8. Hospital Known Patients
-- ============================================================

INSERT INTO hospital_known_patients (hospital_id, patient_id) VALUES
  ('b0000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001'),
  ('b0000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000002'),
  ('b0000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000003'),
  ('b0000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000003'),
  ('b0000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000004'),
  ('b0000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000005')
ON CONFLICT DO NOTHING;

-- ============================================================
-- 9. Hospital Known Products
-- ============================================================

INSERT INTO hospital_known_products (hospital_id, product_id, alias) VALUES
  ('b0000000-0000-0000-0000-000000000004', 'd0000000-0000-0000-0000-000000000001', '코실리콘S'),
  ('b0000000-0000-0000-0000-000000000004', 'd0000000-0000-0000-0000-000000000002', '코실리콘M'),
  ('b0000000-0000-0000-0000-000000000004', 'd0000000-0000-0000-0000-000000000004', '턱고어텍스'),
  ('b0000000-0000-0000-0000-000000000004', 'd0000000-0000-0000-0000-000000000005', 'HA필러0.5'),
  ('b0000000-0000-0000-0000-000000000004', 'd0000000-0000-0000-0000-000000000006', 'HA필러1.0'),
  ('b0000000-0000-0000-0000-000000000005', 'd0000000-0000-0000-0000-000000000002', '코M'),
  ('b0000000-0000-0000-0000-000000000005', 'd0000000-0000-0000-0000-000000000005', 'HA05'),
  ('b0000000-0000-0000-0000-000000000005', 'd0000000-0000-0000-0000-000000000006', 'HA10')
ON CONFLICT DO NOTHING;

-- ============================================================
-- 10. Shipment Batches & Details (거래 이력)
-- ============================================================

-- Batch 1: 제조사 → 유통사 (코 임플란트 S 5개 — codes 6~10)
INSERT INTO shipment_batches (id, from_organization_id, to_organization_id, to_organization_type, shipment_date) VALUES
  ('20000000-0000-0000-0000-000000000001', 'b0000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000003', 'DISTRIBUTOR', '2024-06-15T09:00:00Z');

INSERT INTO shipment_details (shipment_batch_id, virtual_code_id)
SELECT '20000000-0000-0000-0000-000000000001', id
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0001-000000000006', 'f0000000-0000-0000-0001-000000000007',
  'f0000000-0000-0000-0001-000000000008', 'f0000000-0000-0000-0001-000000000009',
  'f0000000-0000-0000-0001-000000000010'
);

-- Batch 2: 유통사 → 병원1 (코 임플란트 S 3개 — codes 11~13)
INSERT INTO shipment_batches (id, from_organization_id, to_organization_id, to_organization_type, shipment_date) VALUES
  ('20000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000004', 'HOSPITAL', '2024-07-01T10:00:00Z');

INSERT INTO shipment_details (shipment_batch_id, virtual_code_id)
SELECT '20000000-0000-0000-0000-000000000002', id
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0001-000000000011', 'f0000000-0000-0000-0001-000000000012',
  'f0000000-0000-0000-0001-000000000013'
);

-- Batch 3: 제조사 → 유통사 (코 임플란트 M 6개)
INSERT INTO shipment_batches (id, from_organization_id, to_organization_id, to_organization_type, shipment_date) VALUES
  ('20000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000003', 'DISTRIBUTOR', '2024-06-20T09:00:00Z');

INSERT INTO shipment_details (shipment_batch_id, virtual_code_id)
SELECT '20000000-0000-0000-0000-000000000003', id
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0003-000000000009', 'f0000000-0000-0000-0003-000000000010',
  'f0000000-0000-0000-0003-000000000011', 'f0000000-0000-0000-0003-000000000012',
  'f0000000-0000-0000-0003-000000000013', 'f0000000-0000-0000-0003-000000000014'
);

-- Batch 4: 유통사 → 병원1 (코 임플란트 M 4개)
INSERT INTO shipment_batches (id, from_organization_id, to_organization_id, to_organization_type, shipment_date) VALUES
  ('20000000-0000-0000-0000-000000000004', 'b0000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000004', 'HOSPITAL', '2024-07-10T10:00:00Z');

INSERT INTO shipment_details (shipment_batch_id, virtual_code_id)
SELECT '20000000-0000-0000-0000-000000000004', id
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0003-000000000015', 'f0000000-0000-0000-0003-000000000016',
  'f0000000-0000-0000-0003-000000000017', 'f0000000-0000-0000-0003-000000000018'
);

-- Batch 5: 유통사 → 병원2 (코 임플란트 M 2개)
INSERT INTO shipment_batches (id, from_organization_id, to_organization_id, to_organization_type, shipment_date) VALUES
  ('20000000-0000-0000-0000-000000000005', 'b0000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000005', 'HOSPITAL', '2024-07-15T10:00:00Z');

INSERT INTO shipment_details (shipment_batch_id, virtual_code_id)
SELECT '20000000-0000-0000-0000-000000000005', id
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0003-000000000019', 'f0000000-0000-0000-0003-000000000020'
);

-- ============================================================
-- 11. Histories (출고/입고 이력)
-- ============================================================

-- Batch 1 histories: 제조사 → 유통사 (코S 5개)
INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, shipment_batch_id, is_recall, created_at)
SELECT id, 'SHIPPED', 'b0000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', false, '2024-06-15T09:00:00Z'
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0001-000000000006', 'f0000000-0000-0000-0001-000000000007',
  'f0000000-0000-0000-0001-000000000008', 'f0000000-0000-0000-0001-000000000009',
  'f0000000-0000-0000-0001-000000000010'
);
INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, shipment_batch_id, is_recall, created_at)
SELECT id, 'RECEIVED', 'b0000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', false, '2024-06-15T09:00:01Z'
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0001-000000000006', 'f0000000-0000-0000-0001-000000000007',
  'f0000000-0000-0000-0001-000000000008', 'f0000000-0000-0000-0001-000000000009',
  'f0000000-0000-0000-0001-000000000010'
);

-- Batch 2 histories: 유통사 → 병원1 (코S 3개)
INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, shipment_batch_id, is_recall, created_at)
SELECT id, 'SHIPPED', 'b0000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000002', false, '2024-07-01T10:00:00Z'
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0001-000000000011', 'f0000000-0000-0000-0001-000000000012',
  'f0000000-0000-0000-0001-000000000013'
);
INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, shipment_batch_id, is_recall, created_at)
SELECT id, 'RECEIVED', 'b0000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000002', false, '2024-07-01T10:00:01Z'
FROM virtual_codes WHERE id IN (
  'f0000000-0000-0000-0001-000000000011', 'f0000000-0000-0000-0001-000000000012',
  'f0000000-0000-0000-0001-000000000013'
);

-- MANUFACTURED histories (각 lot의 모든 코드)
INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, is_recall, created_at)
SELECT vc.id, 'MANUFACTURED', NULL, 'b0000000-0000-0000-0000-000000000002', false, l.manufacture_date::timestamptz
FROM virtual_codes vc
JOIN lots l ON vc.lot_id = l.id
WHERE l.product_id IN (
  'd0000000-0000-0000-0000-000000000001', 'd0000000-0000-0000-0000-000000000002',
  'd0000000-0000-0000-0000-000000000003', 'd0000000-0000-0000-0000-000000000004',
  'd0000000-0000-0000-0000-000000000005', 'd0000000-0000-0000-0000-000000000006',
  'd0000000-0000-0000-0000-000000000007'
);

-- ============================================================
-- 12. Treatment Records (시술 이력 — 일부 코드를 USED로 전환)
-- ============================================================

-- 시술 1: 병원1, 환자1 — 코 임플란트 S 1개 사용
-- code f0000000-0000-0000-0001-000000000011 → USED, patient 1
UPDATE virtual_codes
SET status = 'USED', owner_org_id = NULL, owner_patient_id = '10000000-0000-0000-0000-000000000001'
WHERE id = 'f0000000-0000-0000-0001-000000000011';

INSERT INTO treatment_records (id, hospital_id, patient_phone, treatment_date) VALUES
  ('30000000-0000-0000-0000-000000000001', 'b0000000-0000-0000-0000-000000000004', '010-1111-0001', '2024-08-01');

INSERT INTO treatment_details (treatment_id, virtual_code_id) VALUES
  ('30000000-0000-0000-0000-000000000001', 'f0000000-0000-0000-0001-000000000011');

INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_patient_id, is_recall, created_at) VALUES
  ('f0000000-0000-0000-0001-000000000011', 'TREATED', 'b0000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001', false, '2024-08-01T14:00:00Z');

-- 시술 2: 병원1, 환자2 — 필러 0.5ml 2개 사용
UPDATE virtual_codes
SET status = 'USED', owner_org_id = NULL, owner_patient_id = '10000000-0000-0000-0000-000000000002'
WHERE id IN ('f0000000-0000-0000-0010-000000000015', 'f0000000-0000-0000-0010-000000000016');

INSERT INTO treatment_records (id, hospital_id, patient_phone, treatment_date) VALUES
  ('30000000-0000-0000-0000-000000000002', 'b0000000-0000-0000-0000-000000000004', '010-1111-0002', '2024-08-15');

INSERT INTO treatment_details (treatment_id, virtual_code_id) VALUES
  ('30000000-0000-0000-0000-000000000002', 'f0000000-0000-0000-0010-000000000015'),
  ('30000000-0000-0000-0000-000000000002', 'f0000000-0000-0000-0010-000000000016');

INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_patient_id, is_recall, created_at) VALUES
  ('f0000000-0000-0000-0010-000000000015', 'TREATED', 'b0000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000002', false, '2024-08-15T11:00:00Z'),
  ('f0000000-0000-0000-0010-000000000016', 'TREATED', 'b0000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000002', false, '2024-08-15T11:00:00Z');

-- 시술 3: 병원2, 환자3 — 코 임플란트 M 1개
UPDATE virtual_codes
SET status = 'USED', owner_org_id = NULL, owner_patient_id = '10000000-0000-0000-0000-000000000003'
WHERE id = 'f0000000-0000-0000-0003-000000000019';

INSERT INTO treatment_records (id, hospital_id, patient_phone, treatment_date) VALUES
  ('30000000-0000-0000-0000-000000000003', 'b0000000-0000-0000-0000-000000000005', '010-1111-0003', '2024-09-01');

INSERT INTO treatment_details (treatment_id, virtual_code_id) VALUES
  ('30000000-0000-0000-0000-000000000003', 'f0000000-0000-0000-0003-000000000019');

INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_patient_id, is_recall, created_at) VALUES
  ('f0000000-0000-0000-0003-000000000019', 'TREATED', 'b0000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000003', false, '2024-09-01T15:00:00Z');

-- ============================================================
-- 13. Disposal Records (폐기 이력)
-- ============================================================

-- 병원1: 필러 1.0ml 1개 폐기 (유통기한 임박)
UPDATE virtual_codes
SET status = 'DISPOSED'
WHERE id = 'f0000000-0000-0000-0012-000000000017';

INSERT INTO disposal_records (id, hospital_id, disposal_date, disposal_reason_type) VALUES
  ('40000000-0000-0000-0000-000000000001', 'b0000000-0000-0000-0000-000000000004', '2024-09-15', 'EXPIRED');

INSERT INTO disposal_details (disposal_id, virtual_code_id) VALUES
  ('40000000-0000-0000-0000-000000000001', 'f0000000-0000-0000-0012-000000000017');

INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, disposal_id, is_recall, created_at) VALUES
  ('f0000000-0000-0000-0012-000000000017', 'DISPOSED', 'b0000000-0000-0000-0000-000000000004', 'b0000000-0000-0000-0000-000000000004', '40000000-0000-0000-0000-000000000001', false, '2024-09-15T10:00:00Z');

-- ============================================================
-- 14. Returned Shipment (반품 이력)
-- ============================================================

-- 병원2: 필러 0.5ml 1개 반품 → 유통사
INSERT INTO shipment_batches (id, from_organization_id, to_organization_id, to_organization_type, shipment_date, is_return_batch, parent_batch_id) VALUES
  ('20000000-0000-0000-0000-000000000010', 'b0000000-0000-0000-0000-000000000005', 'b0000000-0000-0000-0000-000000000003', 'DISTRIBUTOR', '2024-10-01T09:00:00Z', true, NULL);

-- 반품된 코드의 소유권 변경 (병원2 → 유통사)
UPDATE virtual_codes
SET owner_org_id = 'b0000000-0000-0000-0000-000000000003'
WHERE id = 'f0000000-0000-0000-0010-000000000020';

INSERT INTO shipment_details (shipment_batch_id, virtual_code_id) VALUES
  ('20000000-0000-0000-0000-000000000010', 'f0000000-0000-0000-0010-000000000020');

INSERT INTO histories (virtual_code_id, action_type, from_org_id, to_org_id, shipment_batch_id, is_recall, recall_reason, created_at) VALUES
  ('f0000000-0000-0000-0010-000000000020', 'RETURNED', 'b0000000-0000-0000-0000-000000000005', 'b0000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000010', true, '제품 불량 의심', '2024-10-01T09:00:00Z');

-- ============================================================
-- 15. Refresh materialized view
-- ============================================================

REFRESH MATERIALIZED VIEW CONCURRENTLY mv_org_code_counts;

-- ============================================================
-- Cleanup seed helper function
-- ============================================================

